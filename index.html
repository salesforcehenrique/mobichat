<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>MobiChat</title>
  <link rel="icon" type="image/x-icon" href="/mobichat/favicon.ico" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    #embeddedMessaging {
      height: 100vh;
    }
  </style>
</head>

<body>
  <div id="embeddedMessaging"></div>
  <div id="my-messaging-container"></div>

  <!-- =========================== -->
  <!-- VARIÁVEIS DE USUÁRIO LOGADO -->
  <!-- =========================== -->

  <script>
    // Esses valores devem vir do seu site / backend no runtime
    window.NomeUsuarioLogado = "Igor Nogueira Silva";
    window.CPFLogado = "085.094.706-50";
    window.NomeConta = "Ita Corretora";
    window.CodigoUsuario = "U-16010";
    window.CodigoConta = "C-9";
  </script>

  <!-- =========================== -->
  <!-- INICIALIZAÇÃO DO MESSAGING -->
  <!-- =========================== -->

  <script type="text/javascript">
    function initEmbeddedMessaging() {
      try {
        embeddedservice_bootstrap.settings.language = 'pt_BR';

        // Configuração principal do Enhanced Messaging
        embeddedservice_bootstrap.settings.embeddedserviceConfig = {
          messaging: {
            enabled: true,

            // ✅ ESSENCIAL: envia dados ao Flow
            prepopulatedPrechatFields: {
              NomeUsuario: window.NomeUsuarioLogado || "",
              CPF: window.CPFLogado || "",
              NomeConta: window.NomeConta || "",
              CodigoUsuario: window.CodigoUsuario || "",
              CodigoConta: window.CodigoConta || ""
            },

            // ✅ OPCIONAL: mostra esses dados ao agente no console
            extraPrechatInfo: [
              { label: "NomeUsuario", value: window.NomeUsuarioLogado || "" },
              { label: "CPF", value: window.CPFLogado || "" },
              { label: "NomeConta", value: window.NomeConta || "" },
              { label: "CodigoUsuario", value: window.CodigoUsuario || "" },
              { label: "CodigoConta", value: window.CodigoConta || "" }
            ]
          }
        };

        // Inicializa o botão de messaging com seu site + org
        embeddedservice_bootstrap.init(
          '00Dbe000002jTkf', // ID da sua org
          'Chat_Mobi',       // Nome do botão
          'https://segimob--staging.sandbox.my.site.com/ESWChatMobi1764466409624', // Site endpoint
          {
            scrt2URL: 'https://segimob--staging.sandbox.my.salesforce-scrt.com'
          }
        );

      } catch (err) {
        console.error('Error loading Embedded Messaging: ', err);
      }
    };
  </script>

  <!-- BOOTSTRAP SCRIPT DO BOTÃO (CORRETO) -->
  <script 
    type="text/javascript"
    src="https://segimob--staging.sandbox.my.site.com/ESWChatMobi1764466409624/assets/js/bootstrap.min.js"
    onload="initEmbeddedMessaging()">
  </script>

  <!-- OPCIONAL: estilo de fundo -->
  <script>
    document.body.style.background = "#f0f0f0";
  </script>

</body>
</html>
