<script type='text/javascript'>
    // Variáveis de contexto do usuário logado (simulação)
    var NomeUsuarioLogado = "Igor Nogueira Silva";
    var CPFLogado = "085.094.706-50";
    var NomeConta = "Ita Corretora";
    var CodigoUsuario = "U-16010";
    var CodigoConta = "C-9";

    var initESW = function(gslcSettings) {
        embedded_svc.settings.displayHelpButton = true; // Exibe o botão de ajuda (chat)
        embedded_svc.settings.language = ''; // Deixe vazio para usar o idioma do navegador

        // Configuração de dados de pré-chat
        embedded_svc.settings.prechatDetails = [
            // {label:"NomeUsuario", value: NomeUsuarioLogado, displayToAgent:true}, // Se você quiser que o agente veja o nome
            // {label:"CPF", value: CPFLogado, displayToAgent:true}, // Se você quiser que o agente veja o CPF
            {label:"NomeConta", value: NomeConta, displayToAgent:false},
            {label:"CodigoUsuario", value: CodigoUsuario, displayToAgent:false},
            {label:"CodigoConta", value: CodigoConta, displayToAgent:false}
        ];

        // Configuração de dados de pré-chat para o Flow (usando setCustomSalesforceChatData)
        embedded_svc.settings.extraPrechatInfo = [
            {
                "entityName": "Contact",
                "saveToTranscript": "NomeUsuario",
                "entityFieldMaps": [
                    {"fieldName": "FirstName", "doFind": false, "is
                    exactMatch": false, "doCreate": true, "
                    "label": "NomeUsuario"}
                ]
            },
            // Adicione outras entidades e campos conforme a sua necessidade de busca e criação de registros
        ];

        // **A forma mais direta para o Flow é usar o prechatDetails e mapear no Flow:**
        embedded_svc.settings.prechatDetails = [
            {label:"NomeUsuario", value: NomeUsuarioLogado, displayToAgent:false},
            {label:"CPF", value: CPFLogado, displayToAgent:false},
            {label:"NomeConta", value: NomeConta, displayToAgent:false},
            {label:"CodigoUsuario", value: CodigoUsuario, displayToAgent:false},
            {label:"CodigoConta", value: CodigoConta, displayToAgent:false}
        ];
        
        // O restante do seu código de inicialização do Embedded Service Chat...
        embedded_svc.init(
            'https://[SEU_DOMINIO].my.salesforce.com',
            'https://[SEU_DOMINIO].my.salesforce-sites.com/liveagent',
            gslcSettings.baseLiveAgentContentURL,
            '[ORG_ID]',
            '[DEPLOYMENT_ID]',
            {
                baseLiveAgentContentURL: gslcSettings.baseLiveAgentContentURL,
                deploymentId: gslcSettings.deploymentId,
                buttonId: gslcSettings.buttonId,
                baseLiveAgentURL: gslcSettings.baseLiveAgentURL,
                eswConfigDevName: gslcSettings.eswConfigDevName,
                isOfflineSupportEnabled: gslcSettings.isOfflineSupportEnabled
            }
         );
    };

    if (!window.embedded_svc) {
        var s = document.createElement('script');
        s.setAttribute('src', 'https://segimob--staging.my.salesforce.com/embeddedservice/5.0/esw.min.js' );
        s.onload = function() {
            initESW(null);
        };
        document.body.appendChild(s);
    } else {
        initESW('https://segimob--staging.my.salesforce.com' );
    }
</script>
